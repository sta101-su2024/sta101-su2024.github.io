{
  "hash": "5048d8d167e7d73fd2f7c0f0fe4717ab",
  "result": {
    "markdown": "---\ntitle: \"COVID vaccine and deaths from Delta variant\"\ncategories: \n  - Application exercise\n  - Suggested answers\neditor: visual\neditor_options: \n  chunk_output_type: console\n---\n\n\nThe main question we'll explore today is \"How do deaths from COVID cases compare between vaccinated and unvaccinated?\"\n\nWhat do you think?\n\n# Goals\n\n-   Creating data visualizations and calculating summary statistics for comparing trends across groups\n\n-   Distinguishing observational studies and experiments\n\n-   Reviewing various sampling methods\n\n-   Identifying confounding variables and Simpson's paradox\n\n# Packages\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.2     ✔ readr     2.1.4\n✔ forcats   1.0.0     ✔ stringr   1.5.0\n✔ ggplot2   3.4.3     ✔ tibble    3.2.1\n✔ lubridate 1.9.2     ✔ tidyr     1.3.0\n✔ purrr     1.0.2     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n\n\n:::\n:::\n\n\n# Data\n\nThe data for this case study come from a technical briefing published by Public Health England in August 2021 on COVID cases, vaccinations, and deaths from the Delta variant.\n\nFirst, let's load the data:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndelta <- read_csv(\"data/delta.csv\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nRows: 268166 Columns: 3\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr (3): vaccine, age, outcome\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n\n\n:::\n:::\n\n\n# Visualizing and summarizing categorical data\n\n## Exercise 1\n\nHow many rows and columns are in this dataset? Answer in a full sentence using **inline code**. What does each row represent and what does each column represent? For each variable, identify its type.\n\n*Add your answer here.*\n\n## Exercise 2\n\nDo these data come from an observational study or experiment? Why?\n\n*Add your answer here.*\n\n## Exercise 3\n\nCreate a visualization of health outcome by vaccine status that allows you to compare the proportion of deaths across those who are and are not vaccinated. What can you say about death rates in these two groups based on this visualization?\n\n*Add your answer here.*\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# add code here\n```\n:::\n\n\n## Exercise 4\n\nCalculate the proportion of deaths in among those who are vaccinated. Then, calculate the proportion among those who are not vaccinated.\n\n*Add your answer here.*\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# add code here\n```\n:::\n\n\n## Exercise 5\n\nCreate the visualization and calculate proportions from the two previous exercises, this time controlling for age. How do the proportions compare?\n\n*Add your answer here.*\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# add code here\n```\n:::\n\n\n## Exercise 6\n\nBased on your findings so far, fill in the blanks with *more*, *less*, or *equally*: Is there anything surprising about these statements? Speculate on what, if anything, the discrepancy might be due to.\n\n-   In 2021, among those in the UK who were COVID Delta cases, the vaccinated were \\_\\_\\_ likely to die than the unvaccinated.\n\n-   For those under 50, those who were unvaccinated were \\_\\_\\_ likely to die than those who were vaccinated.\n\n-   For those 50 and up, those who were unvaccinated were \\_\\_\\_ likely to die than those who were vaccinated.\n\n*Add your answer here.*\n\n# Simpson's Paradox\n\n**Simpson's paradox** is a phenomenon in which a trend appears in subsets of the data, but disappears or reverses when the subsets are combined. The paradox can be resolved when **confounding variables** and causal relations are appropriately addressed in the analysis.\n\n## Exercise 7\n\nLet's rephrase the previous question which asked you to speculate on why deaths among vaccinated cases overall is higher while deaths among unvaccinated cases are higher when we split the data into two groups (below 50 and 50 and up). What might be the confounding variable in the relationship between vaccination and deaths?\n\n*Add your answer here.*\n\n## Exercise 8\n\nVisualize and describe the distribution of seniors (50 and up) based on (a.k.a. conditional on) vaccination status. Hint: Your description will benefit from calculating proportions of seniors in each of the vaccination groups and working those values into your narrative.\n\nAdd your answer here.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# add your code here\n```\n:::\n\n\n# Summary\n\nThe percentages of deaths from COVID across vaccination groups is as follows:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nvaccine_outcome_perc <- delta |>\n  count(vaccine, outcome) |>\n  group_by(vaccine) |>\n  mutate(perc = round(n / sum(n) * 100, 2)) |>\n  filter(outcome == \"died\") |>\n  select(-outcome, -n)\n```\n:::\n\n\nAlso considering age groups, the death rates are as follows:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nvaccine_age_outcome_perc <- delta |>\n  count(vaccine, age, outcome) |>\n  group_by(vaccine, age) |>\n  mutate(perc = round(n / sum(n) * 100, 2)) |>\n  filter(outcome == \"died\") |>\n  select(-outcome, -n)\n```\n:::\n\n\nWe can *pivot* these data for better display; we'll learn more about these \"data moves\" soon:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nvaccine_age_outcome_perc |>\n  pivot_wider(names_from = age, values_from = perc)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 2 × 3\n# Groups:   vaccine [2]\n  vaccine      `50+` `<50`\n  <chr>        <dbl> <dbl>\n1 Unvaccinated  5.96  0.03\n2 Vaccinated    1.68  0.02\n```\n\n\n:::\n:::\n\n\nWe identified age as a potential confounding variable in the relationship between. So let's take a look at the distribution of age in the data:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nage_props <- delta |>\n  count(age) |>\n  mutate(p = n / sum(n))\n```\n:::\n\n\nAnd then, let's use these proportions to *weigh* the percentages of deaths.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nvaccine_age_outcome_perc |>\n  mutate(perc_wt = if_else(age == \"50+\", perc * 0.115, perc * 0.885)) |>\n  group_by(vaccine) |>\n  summarize(perc = sum(perc_wt))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 2 × 2\n  vaccine       perc\n  <chr>        <dbl>\n1 Unvaccinated 0.712\n2 Vaccinated   0.211\n```\n\n\n:::\n:::\n\n\nRevisiting the question we posed to start with: How do deaths from COVID cases compare between vaccinated and unvaccinated?\n\n# Acknowledgements\n\nThis case study is inspired by [Statistical Literacy: Simpson's Paradox and Covid Deaths](http://www.statlit.org/pdf/2021-Schield-ASA-BOF.pdf) by Milo Schield.\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}